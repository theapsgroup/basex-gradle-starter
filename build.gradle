repositories {
    maven { url "http://files.basex.org/maven" }
    maven { url "http://xqj.net/maven" }
    mavenCentral()
}

configurations {
    basex
}

def jettyVersion = '8.1.16.v20140903'

dependencies {
    basex "org.basex:basex-api:8.1-SNAPSHOT"
    // XQJ API
    basex "net.xqj:basex-xqj:1.2.0"
    basex "com.xqj2:xqj2:0.1.0"
    basex "javax.xml.xquery:xqj-api:1.0"
    // HTTP server
    basex "org.eclipse.jetty:jetty-continuation:${jettyVersion}"
    basex "org.eclipse.jetty:jetty-http:${jettyVersion}"
    basex "org.eclipse.jetty:jetty-io:${jettyVersion}"
    basex "org.eclipse.jetty:jetty-security:${jettyVersion}"
    basex "org.eclipse.jetty:jetty-server:${jettyVersion}"
    basex "org.eclipse.jetty:jetty-servlet:${jettyVersion}"
    basex "org.eclipse.jetty:jetty-util:${jettyVersion}"
    basex "org.eclipse.jetty:jetty-webapp:${jettyVersion}"
    basex "org.eclipse.jetty:jetty-xml:${jettyVersion}"
    // XSLT 2.0
    basex "net.sf.saxon:Saxon-HE:9.6.0-4"
    // HTML parsing
    basex "org.ccil.cowan.tagsoup:tagsoup:1.2.1"
    // XML catalogs
    basex "xml-resolver:xml-resolver:1.2"
}

task cfg << {
    println "Transitive: ${configurations.basex.transitive}"
}

task server << {
    description "Start BaseX database server."
    classpath configurations.basex
    main = "org.basex.BaseXServer"
    systemProperties System.getProperties()
}

task serverstop(type: JavaExec) {
    description "Stop BaseX HTTP server."
    classpath configurations.basex
    main = "org.basex.BaseXServer"
    args "stop"
    systemProperties System.getProperties()
}

task http(type: JavaExec) {
    description "Start BaseX HTTP and database server."
    classpath configurations.basex
    main = "org.basex.BaseXHTTP"
    systemProperties System.getProperties()
}

task httpstop(type: JavaExec) {
    description "Stop BaseX HTTP and database server."
    classpath configurations.basex
    main = "org.basex.BaseXHTTP"
    args "stop"
    systemProperties System.getProperties()
}

// although typing works, the standard gradle build message
// makes this awkward. 
// See also https://issues.gradle.org/browse/GRADLE-1168
task console(type: JavaExec) {
    description "Start BaseX client console."
    standardInput = System.in
    classpath configurations.basex
    main = "org.basex.BaseXClient"
    systemProperties System.getProperties()
}

task gui << {
    ant.java(
        fork: true, 
        spawn: true, 
        classpath: configurations.basex.asPath, 
        classname: "org.basex.BaseXGUI",
        clonevm: true)
}
gui.description "Run BaseX GUI."

task query(type: JavaExec) {
    description "Start a simple query."
    classpath configurations.basex
    main = "org.basex.BaseX"
    args "-q", project.hasProperty('q') ? q : "'Please provide a query! Example: gradlew query -Pq=1+1'"
    systemProperties System.getProperties()
}

task test(type: JavaExec) {
    description "Runs all tests."
    classpath configurations.basex
    main = "org.basex.BaseX"
    args "-t", file(System.properties['org.basex.WEBPATH'])
    systemProperties System.getProperties()
}